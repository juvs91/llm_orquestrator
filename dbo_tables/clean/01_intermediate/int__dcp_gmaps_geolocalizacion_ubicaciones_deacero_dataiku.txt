with de_duplicacion_dataiku as (
    select
        *--,
        --row_number() over(
            --partition by pks...
            --order by fechaultimamod desc
        --) as rownum
    from {{ ref('stg__gmaps_geolocalizacion_ubicaciones_deacero_dataiku') }}
),

sel_dataiku as (
    select
        --{ dbt_utils.generate_surrogate_key(['col_pk1', 'col_pk2']) } as pk_dataiku,
        _airbyte_raw_id,
        _airbyte_extracted_at,
        _airbyte_meta,
        url,
        response,
        claubicacion,
        json_extract_scalar(
            response, '$.results[0].geometry.bounds.southwest.lat'
        ) as latitud,
        json_extract_scalar(
            response, '$.results[0].geometry.bounds.southwest.lng'
        ) as longitud,
        concat('point(', json_extract_scalar(
            response, '$.results[0].geometry.bounds.southwest.lng'
        ), ' ', json_extract_scalar(
            response,
            '$.results[0].geometry.bounds.southwest.lat'
        ), ')')
            as coordenadas
    from de_duplicacion_dataiku
    --where rownum = 1
)

select *
from sel_dataiku
